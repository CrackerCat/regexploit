from sre_parse import parse as sre_parse

from redos import find_redos
from sequence import Sequence
from sre import SreOpParser

def from_regex(pattern: str) -> Sequence:
    repeat = SreOpParser.sequence_or_singleton(sre_parse(pattern))
    return repeat

def found(pattern: str):
    return list(find_redos(from_regex(pattern)))

def test_no_repeats():
    assert len(found(r'aaaaa[abc](\w[\wz]){1,7}X[^x]')) == 0

def test_simple_repeat_with_backtracking():
    r = found(r'abd\w*[def]\w+[de]!')