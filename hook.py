# The module records any regexes used by python code for later inspection.
# Import this hook before loading other modules or start python with `python -i /path/to/hook.py`
import re

old_compile = re.compile
regexes = set()


def compile(pattern, flags=0):
    regexes.add((pattern, flags))
    return old_compile(pattern, flags)


re.compile = compile


def get_and_clear_regexes():
    while True:
        try:
            yield regexes.pop()
        except KeyError:
            return
