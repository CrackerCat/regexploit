# Check ua_parser for REDoS
# Vulnerable (https://github.com/ua-parser/uap-core/security/advisories/GHSA-cmcx-xhr8-3w9p)
# pip install ua_parser==0.9.0
# Fixed
# pip install ua_parser>=0.10.0
from sre import SreOpParser

import ua_parser
from ua_parser import user_agent_parser

from redos import find_redos


if __name__ == "__main__":
    ua_parser_regex = [
        p.pattern
        for p in ua_parser._regexes.USER_AGENT_PARSERS
        + ua_parser._regexes.DEVICE_PARSERS
    ]

    for pattern in ua_parser_regex:
        parsed = SreOpParser.parse_sre(pattern)
        for redos in find_redos(parsed):
            if redos.starriness > 2:
                print(redos, "for", pattern)
                print(redos.example())
