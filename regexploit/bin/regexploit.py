#!/usr/bin/env python
import fileinput
import sys

from regexploit.ast.sre import SreOpParser
from regexploit.redos import find
from regexploit.output.text import TextOutput


def find_redos(pattern: str, flags: int, output: TextOutput):
    try:
        parsed = SreOpParser.parse_sre(pattern, flags)
    except Exception as e:
        print("Error", e)
        return
    output.next()
    for redos in find(parsed):
        if redos.starriness > 2:
            output.record(redos, pattern)
            yield redos


def main():
    output = TextOutput()
    try:
        for line in fileinput.input():
            for _ in find_redos(line.rstrip("\n"), 0, output):
                pass
    except KeyboardInterrupt:
        pass


if __name__ == "__main__":
    main()
