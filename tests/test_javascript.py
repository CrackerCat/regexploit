import re

import pytest

from regexploit.javascript import fix_js_regex


@pytest.mark.parametrize(
    "r,f",
    [
        # Carat
        (r"[^]", r"\^"),
        (r"[^][^][^]", r"\^\^\^"),
        (r"([^])+([^])+([^])+", r"(\^)+(\^)+(\^)+"),
        (r"[^][^][^]([\[^])+", r"\^\^\^([\[^])+"),
        # Named groups
        (r"(?<x>y>)+(?<ab_cD0>abc)\(?<a>", r"(?P<x>y>)+(?P<ab_cD0>abc)\(?<a>"),
        # Hyphen in character class
        (r"[\w-:]", r"[\w\-:]"),
        (r"[!-\w]", r"[!\-\w]"),
    ],
)
def test_fixes(r, f):
    with pytest.raises(re.error):
        re.compile(r)
    fixed = fix_js_regex(r)
    assert fixed == f
    re.compile(fixed)
